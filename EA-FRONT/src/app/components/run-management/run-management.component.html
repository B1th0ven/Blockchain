

<div class="mt-2"  *ngIf="busy">
  <app-loader class="mt-5" [type]="1"></app-loader>
  <div class="pb-5 pt-5"></div>
</div>

<div class="mt-2" *ngIf="err">
  <div class="alert alert-danger">{{err}} </div>
</div>

<div *ngIf="study&&runs&&dimensions&&!busy&&!err">
  <ul class="nav nav-tabs inner mt-3">
    <li *ngFor="let tab of tabs ; let i = index" (click)="openTab(i)" class="nav-item">
      <a class="nav-link" [ngClass]="{'active':i==activeTab}">
        <span *ngIf="!runs[i].id">{{tab.name}}</span>
        <span *ngIf="runs[i].id">{{'Run ' + (i+1) }}</span>
        <span *ngIf="runs&&runs[i]&&tabs.length>1&&!runs[i].id"> &nbsp;
          <fa class="close-icon" (click)="remove(i,$event)" name="close"></fa>
        </span>
      </a>
    </li>
    <li *ngIf="canCreateRun()" (click)="newTab('newrun')" class="nav-item">
      <a class="nav-link nav-link-radius">
        <fa class="text-primary" name="plus" style="font-size:12px"></fa>
      </a>
    </li>
  </ul>

  <div class="tab-content">

    <div *ngFor="let tab of tabs ; let i = index" class="tab-pane" [ngClass]="{'active':i==activeTab}" >




      <div class="container-fluid" *ngIf="runs[i]">
          <div *ngIf="runs[i].id" class="mt-3">
              <app-run-information [run]="runs[i]" (done)="onLaunchDone()"></app-run-information>
              <hr style="margin-left: -15px;margin-right: -15px;">
          </div>
        <div class="row mt-3 mb-3 row-header font-size-sm">

          <div class="col-md-3" *ngIf="study.id">
            <b>Study ID</b> {{study.code}}
          </div>

          <div *ngIf="runs[i].id" class="col-md-3">
            <b>Run ID</b>{{runs[i].id}}
          </div>

          <div class="col-md-3">
            <b>Created By</b> {{concatinate(runs[i].createdBy?.ruFirstName,runs[i].createdBy?.ruLastName) | stringLimit }}
          </div>
          <div class="col-md-3">

            <b>Creation Date</b> {{runs[i].creation_date?.toString() }}

          </div>
        </div>

        <hr style="margin-left: -15px;margin-right: -15px;">


         <div class="row">
          <div class="col-lg-6">
            <app-run-general [dimensions]="dimensions" [datasets]="datasets" [run]="runs[i]" [tab]="i" [screen]="tab_number" [canEditRun] = "canEditRun()" [canEditPerm]="canEditPerm()" (headerCheck)="checkAdjustment($event)"></app-run-general>
          </div>
          <div class="col-lg-6">
            <app-run-decrement [datasets]="datasets" [dimensions]="dimensions" [study]="study" [run]="runs[i]" [tab]="i" [screen]="tab_number" [isPolicyDuration]="checkAdjust"  [canEditRun] = "canEditRun()" [canEditPerm]="canEditPerm()" (saveRun)="onExpRunSave($event,i)"></app-run-decrement>
          </div>
        </div>



        <hr style="margin-left: -15px;margin-right: -15px;">

        <div class="clear-fix">
          <div class="float-right mb-4 m">
            <button class="btn btn-sm btn-primary" style="min-width:100px" [disabled]="!canRun(fv,runs[i])||!canUserLaunchRun()" (click)="launchAndSave(runs[i])">Launch Run</button>
          </div>
          <div class="float-right mb-4 mr-2">
            <button class="btn btn-sm btn-primary" style="min-width:100px" [disabled]="!canSave(fv,runs[i])||!canEditPerm()" (click)="save(runs[i],i)">Save</button>
          </div>

          <div class="float-right mb-4 mr-2">
              <button class="btn btn-sm btn-primary" style="min-width:100px" [disabled]="!canDownload(runs[i])" (click)="download(runs[i])">Download Reports</button>
            </div>
            <div class="float-right mb-4 mr-2">
              <button class="btn btn-sm btn-danger" style="min-width:100px" [disabled]="!canDownloadError(runs[i])" (click)="downloadErrorReport(runs[i])">Download Error Report</button>
            </div>
            <div class="float-right mb-4 mr-2">
                <button class="btn btn-sm btn-primary" style="min-width:100px" [disabled]="!canDuplicate()||!canEditPerm()" (click)="duplicateRun(runs[i])">Duplicate Run</button>
              </div>
            <div class="float-right mb-4 mr-2">
                <button class="btn btn-sm btn-danger" style="min-width:100px" [disabled]="!canDelete(runs[i])||!canUserDeleteRun()" (click)="openDeleteModal(content)">Delete Run</button>
              </div>
        </div>

      </div>
      <ng-template #content let-c="close" let-d="dismiss">
          <div class="modal-header">
            <div class="row">
              <div class="col-md-12">
                <b class="text-primary font-weight-boldest">
                    {{modalMsg?.title}}
                </b>
              </div>
            </div>
          </div>
          <div class="modal-body text-center row">
              <div class="col-md-1"></div>
              <div class="col-md-1">
                  <fa name="trash fa-3x" class="text-danger"></fa>
              </div>
              <div class="col-md-9 align-middle">
                  <p class="font-weight-normal mt-2">{{modalMsg?.body}}</p>
             </div>
              <div class="col-md-1"></div>
          </div>
          <div class="modal-footer">
            <button type="button" class="btn btn-primary" (click)="delete(runs[i],i,c,$event)">Yes</button>
            <button type="button" class="btn btn-light" (click)="c('Close click')">No</button>
          </div>
        </ng-template>
    </div>
  </div>

</div>



